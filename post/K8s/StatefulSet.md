# K8s StatefulSet 拓扑状态

## 有状态应用

> 分布式应用，它的多个实例之间，往往有依赖关系，比如：主从关系、主备关系。
> 数据存储类应用，它的多个实例，往往都会在本地磁盘上保存一份数据。而这些实例一旦被杀掉，即便重建出来，实例与数据之间的对应关系也已经丢失，从而导致应用失败。所以，这种实例之间有不对等关系，以及实例对外部数据有依赖关系的应用，就被称为“有状态应用”

## 无状态应用

> “无状态应用”（Stateless Application），尤其是 Web 服务

## StatefulSet 的设计

> StatefulSet 的核心功能，就是通过某种方式记录这些状态，然后在 Pod 被重新创建时，能够为新 Pod 恢复这些状态。

### 应用状态抽象

1. 拓扑状态。这种情况意味着，应用的多个实例之间不是完全对等的关系。
2. 存储状态。这种情况意味着，应用的多个实例分别绑定了不同的存储数据。

## Headless Service

> Service 被访问

第一种方式，是以 Service 的 VIP（Virtual IP，即：虚拟 IP）方式。比如：当我访问 10.0.23.1 这个 Service 的 IP 地址时，10.0.23.1 其实就是一个 VIP，它会把请求转发到该 Service 所代理的某一个 Pod 上。这里的具体原理，我会在后续的 Service 章节中进行详细介绍。
第二种方式，就是以 Service 的 DNS 方式。比如：这时候，只要我访问“my-svc.my-namespace.svc.cluster.local”这条 DNS 记录，就可以访问到名叫 my-svc 的 Service 所代理的某一个 Pod。
